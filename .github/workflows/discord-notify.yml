name: üõ∞ Discord Notifications Pro

on:
  push:
    branches:
      - '**'
  pull_request:
    types: [opened, closed, merged]
  issues:
    types: [opened, closed, edited, assigned, unlabeled]

jobs:
  notify:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: üõ∞ Prepare Discord Message
        id: prepare
        run: |
          # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ü–≤–µ—Ç embed –ø–æ –≤–µ—Ç–∫–µ
          case "${{ github.ref_name }}" in
            main) COLOR=3066993 ;;          # –∑–µ–ª—ë–Ω—ã–π
            develop|dev) COLOR=3447003 ;;   # —Å–∏–Ω–∏–π
            feature/*) COLOR=10181046 ;;    # —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π
            *) COLOR=15105570 ;;            # —Å–µ—Ä—ã–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
          esac
          echo "color=$COLOR" >> $GITHUB_OUTPUT

          # –§–æ—Ä–º–∏—Ä—É–µ–º JSON payload
          if [ "${{ github.event_name }}" == "push" ]; then
            cat <<EOF > payload.json
            {
              "embeds": [{
                "title": "üì¶ –ù–æ–≤—ã–π Push –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π",
                "color": $COLOR,
                "fields": [
                  { "name": "–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π", "value": "${{ github.repository }}", "inline": true },
                  { "name": "–í–µ—Ç–∫–∞", "value": "${{ github.ref_name }}", "inline": true },
                  { "name": "–ê–≤—Ç–æ—Ä", "value": "${{ github.actor }}", "inline": true },
                  { "name": "–°–æ–æ–±—â–µ–Ω–∏–µ", "value": "${{ github.event.head_commit.message }}" }
                ],
                "url": "${{ github.event.head_commit.url }}",
                "footer": { "text": "GitHub Actions ‚Ä¢ Push Event" }
              }]
            }
            EOF
          elif [ "${{ github.event_name }}" == "pull_request" ]; then
            cat <<EOF > payload.json
            {
              "embeds": [{
                "title": "üí¨ Pull Request ${{ github.event.action }}",
                "color": $COLOR,
                "fields": [
                  { "name": "PR", "value": "[#${{ github.event.pull_request.number }}](${{ github.event.pull_request.html_url }})", "inline": true },
                  { "name": "–ê–≤—Ç–æ—Ä", "value": "${{ github.actor }}", "inline": true },
                  { "name": "–ù–∞–∑–≤–∞–Ω–∏–µ", "value": "${{ github.event.pull_request.title }}" }
                ],
                "footer": { "text": "GitHub Actions ‚Ä¢ PR Event" }
              }]
            }
            EOF
          elif [ "${{ github.event_name }}" == "issues" ]; then
            cat <<EOF > payload.json
            {
              "embeds": [{
                "title": "üìù Issue ${{ github.event.action }}",
                "color": $COLOR,
                "fields": [
                  { "name": "Issue", "value": "[#${{ github.event.issue.number }}](${{ github.event.issue.html_url }})", "inline": true },
                  { "name": "–ê–≤—Ç–æ—Ä", "value": "${{ github.actor }}", "inline": true },
                  { "name": "–ù–∞–∑–≤–∞–Ω–∏–µ", "value": "${{ github.event.issue.title }}" }
                ],
                "footer": { "text": "GitHub Actions ‚Ä¢ Issue Event" }
              }]
            }
            EOF
          fi

      - name: üíå Send to Discord
        run: |
          curl -H "Content-Type: application/json" \
               -X POST \
               -d @payload.json \
               "${{ secrets.DISCORD_WEBHOOK_URL }}"
