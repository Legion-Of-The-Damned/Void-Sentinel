name: üõ∞ Discord Notifications Pro

on:
  push:
    branches:
      - '**'
  pull_request:
    types: [opened, closed, merged]
  issues:
    types: [opened, closed, edited, assigned, unlabeled]

jobs:
  notify:
    runs-on: ubuntu-latest

    steps:
      - name: ‚úÖ Checkout repository
        uses: actions/checkout@v4
        continue-on-error: true  # –¥–∞–∂–µ –µ—Å–ª–∏ git –Ω–µ –Ω–∞–π–¥–µ—Ç —Ä–µ–ø–æ, –∏–¥–µ–º –¥–∞–ª—å—à–µ

      - name: üõ∞ Prepare Discord Message
        id: prepare
        shell: bash
        run: |
          set -e
          echo "GitHub event: ${{ github.event_name }}"
          echo "Branch: ${{ github.ref_name }}"

          COLOR=15105570
          if [[ "${{ github.ref_name }}" == "main" ]]; then COLOR=3066993; fi
          if [[ "${{ github.ref_name }}" =~ ^(dev|develop)$ ]]; then COLOR=3447003; fi
          echo "color=$COLOR" >> $GITHUB_OUTPUT

          PAYLOAD_FILE="payload.json"

          case "${{ github.event_name }}" in
            push)
              cat <<EOF > $PAYLOAD_FILE
              {
                "embeds": [{
                  "title": "üì¶ –ù–æ–≤—ã–π Push",
                  "color": $COLOR,
                  "fields": [
                    { "name": "–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π", "value": "${{ github.repository }}", "inline": true },
                    { "name": "–í–µ—Ç–∫–∞", "value": "${{ github.ref_name }}", "inline": true },
                    { "name": "–ê–≤—Ç–æ—Ä", "value": "${{ github.actor }}", "inline": true },
                    { "name": "–ö–æ–º–º–∏—Ç", "value": "${{ github.event.head_commit.message || 'N/A' }}" }
                  ],
                  "url": "${{ github.event.head_commit.url || github.server_url }}",
                  "footer": { "text": "GitHub Actions ‚Ä¢ Push Event" }
                }]
              }
              EOF
              ;;
            pull_request)
              cat <<EOF > $PAYLOAD_FILE
              {
                "embeds": [{
                  "title": "üí¨ Pull Request ${{ github.event.action }}",
                  "color": $COLOR,
                  "fields": [
                    { "name": "PR", "value": "[#${{ github.event.pull_request.number }}](${{ github.event.pull_request.html_url }})", "inline": true },
                    { "name": "–ê–≤—Ç–æ—Ä", "value": "${{ github.actor }}", "inline": true },
                    { "name": "–ù–∞–∑–≤–∞–Ω–∏–µ", "value": "${{ github.event.pull_request.title }}" }
                  ]
                }]
              }
              EOF
              ;;
            issues)
              cat <<EOF > $PAYLOAD_FILE
              {
                "embeds": [{
                  "title": "üìù Issue ${{ github.event.action }}",
                  "color": $COLOR,
                  "fields": [
                    { "name": "Issue", "value": "[#${{ github.event.issue.number }}](${{ github.event.issue.html_url }})", "inline": true },
                    { "name": "–ê–≤—Ç–æ—Ä", "value": "${{ github.actor }}", "inline": true },
                    { "name": "–ù–∞–∑–≤–∞–Ω–∏–µ", "value": "${{ github.event.issue.title }}" }
                  ]
                }]
              }
              EOF
              ;;
          esac

      - name: üíå Send to Discord
        run: |
          if [ -f payload.json ]; then
            curl -H "Content-Type: application/json" \
                 -X POST \
                 -d @payload.json \
                 "${{ secrets.DISCORD_WEBHOOK_URL }}"
          else
            echo "‚ö†Ô∏è No payload.json found ‚Äî skipping Discord notification."
          fi
